<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¢†å–è°ƒè¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .debug-result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .warning {
            background: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }
        .connect-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .connect-button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>ğŸ” é¢†å–è°ƒè¯•é¡µé¢</h1>
    
    <div class="debug-section">
        <h2>é’±åŒ…è¿æ¥</h2>
        <button class="connect-button" onclick="connectWallet()">è¿æ¥é’±åŒ…</button>
        <div id="wallet-result" class="debug-result"></div>
    </div>

    <div class="debug-section">
        <h2>è·å¥–åœ°å€æ£€æŸ¥</h2>
        <button class="connect-button" onclick="checkWinnerAddress()">æ£€æŸ¥è·å¥–åœ°å€</button>
        <div id="winner-result" class="debug-result"></div>
    </div>

    <div class="debug-section">
        <h2>å¥–åŠ±æ•°æ®æ£€æŸ¥</h2>
        <button class="connect-button" onclick="checkRewardData()">æ£€æŸ¥å¥–åŠ±æ•°æ®</button>
        <div id="reward-result" class="debug-result"></div>
    </div>

    <div class="debug-section">
        <h2>åŒ¹é…æ£€æŸ¥</h2>
        <button class="connect-button" onclick="checkMatch()">æ£€æŸ¥åŒ¹é…</button>
        <div id="match-result" class="debug-result"></div>
    </div>

    <script>
        let walletAddress = null;

        // è¿æ¥é’±åŒ…
        async function connectWallet() {
            const resultDiv = document.getElementById('wallet-result');
            
            try {
                // æ£€æŸ¥æ˜¯å¦å®‰è£…äº† Phantom é’±åŒ…
                if (typeof window.solana !== 'undefined' && window.solana.isPhantom) {
                    const response = await window.solana.connect();
                    walletAddress = response.publicKey.toString();
                    
                    resultDiv.textContent = `âœ… é’±åŒ…è¿æ¥æˆåŠŸ:
âœ… é’±åŒ…åœ°å€: ${walletAddress}
âœ… é’±åŒ…ç±»å‹: Phantom`;
                    resultDiv.className = 'debug-result success';
                } else {
                    resultDiv.textContent = `âŒ Phantom é’±åŒ…æœªå®‰è£…æˆ–æœªæ£€æµ‹åˆ°
è¯·å®‰è£… Phantom é’±åŒ…æ‰©å±•ç¨‹åº`;
                    resultDiv.className = 'debug-result error';
                }
            } catch (error) {
                resultDiv.textContent = `âŒ é’±åŒ…è¿æ¥å¤±è´¥: ${error.message}`;
                resultDiv.className = 'debug-result error';
            }
        }

        // æ£€æŸ¥è·å¥–åœ°å€
        function checkWinnerAddress() {
            const resultDiv = document.getElementById('winner-result');
            
            try {
                const rewardAddressData = localStorage.getItem('mainCountdownRewardAddress');
                
                if (rewardAddressData) {
                    const rewardConfig = JSON.parse(rewardAddressData);
                    
                    resultDiv.textContent = `âœ… è·å¥–åœ°å€é…ç½®:
âœ… åœ°å€: ${rewardConfig.address}
âœ… ç§¯åˆ†: ${rewardConfig.amount}
âœ… è®¾ç½®çŠ¶æ€: ${rewardConfig.isSet ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®'}
âœ… æ›´æ–°æ—¶é—´: ${rewardConfig.lastUpdate}`;
                    resultDiv.className = 'debug-result success';
                } else {
                    resultDiv.textContent = `âŒ æœªæ‰¾åˆ°è·å¥–åœ°å€é…ç½®
localStorage ä¸­æ²¡æœ‰ mainCountdownRewardAddress æ•°æ®`;
                    resultDiv.className = 'debug-result error';
                }
            } catch (error) {
                resultDiv.textContent = `âŒ æ£€æŸ¥è·å¥–åœ°å€å¤±è´¥: ${error.message}`;
                resultDiv.className = 'debug-result error';
            }
        }

        // æ£€æŸ¥å¥–åŠ±æ•°æ®
        function checkRewardData() {
            const resultDiv = document.getElementById('reward-result');
            
            try {
                const mainCountdownRewards = JSON.parse(localStorage.getItem('mainCountdownRewards') || '[]');
                
                resultDiv.textContent = `âœ… å¥–åŠ±æ•°æ®æ£€æŸ¥:
âœ… æ€»å¥–åŠ±æ•°: ${mainCountdownRewards.length}
âœ… å·²é¢†å–: ${mainCountdownRewards.filter(r => r.claimed).length}
âœ… å¾…é¢†å–: ${mainCountdownRewards.filter(r => !r.claimed).length}

è¯¦ç»†æ•°æ®:
${JSON.stringify(mainCountdownRewards.slice(0, 3), null, 2)}
${mainCountdownRewards.length > 3 ? `... è¿˜æœ‰ ${mainCountdownRewards.length - 3} ä¸ªå¥–åŠ±` : ''}`;
                resultDiv.className = 'debug-result success';
            } catch (error) {
                resultDiv.textContent = `âŒ æ£€æŸ¥å¥–åŠ±æ•°æ®å¤±è´¥: ${error.message}`;
                resultDiv.className = 'debug-result error';
            }
        }

        // æ£€æŸ¥åŒ¹é…
        function checkMatch() {
            const resultDiv = document.getElementById('match-result');
            
            if (!walletAddress) {
                resultDiv.textContent = `âš ï¸ è¯·å…ˆè¿æ¥é’±åŒ…`;
                resultDiv.className = 'debug-result warning';
                return;
            }
            
            try {
                const rewardAddressData = localStorage.getItem('mainCountdownRewardAddress');
                
                if (!rewardAddressData) {
                    resultDiv.textContent = `âŒ æœªæ‰¾åˆ°è·å¥–åœ°å€é…ç½®`;
                    resultDiv.className = 'debug-result error';
                    return;
                }
                
                const rewardConfig = JSON.parse(rewardAddressData);
                const isMatch = rewardConfig.address === walletAddress;
                
                resultDiv.textContent = `ğŸ” åŒ¹é…æ£€æŸ¥ç»“æœ:
âœ… å½“å‰é’±åŒ…: ${walletAddress}
âœ… è·å¥–åœ°å€: ${rewardConfig.address}
âœ… åœ°å€åŒ¹é…: ${isMatch ? 'âœ… åŒ¹é…' : 'âŒ ä¸åŒ¹é…'}
âœ… è®¾ç½®çŠ¶æ€: ${rewardConfig.isSet ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®'}

${isMatch ? 'ğŸ‰ æ­å–œï¼æ‚¨çš„é’±åŒ…åœ°å€ä¸è·å¥–åœ°å€åŒ¹é…ï¼' : 'âš ï¸ æ‚¨çš„é’±åŒ…åœ°å€ä¸è·å¥–åœ°å€ä¸åŒ¹é…ï¼Œè¯·æ£€æŸ¥é’±åŒ…åœ°å€ã€‚'}`;
                resultDiv.className = isMatch ? 'debug-result success' : 'debug-result error';
            } catch (error) {
                resultDiv.textContent = `âŒ æ£€æŸ¥åŒ¹é…å¤±è´¥: ${error.message}`;
                resultDiv.className = 'debug-result error';
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¢†å–è°ƒè¯•é¡µé¢å·²åŠ è½½');
            checkWinnerAddress();
            checkRewardData();
        });
    </script>
</body>
</html> 