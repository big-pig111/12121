<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” å¥–åŠ±ç³»ç»Ÿæ•°æ®äº’é€šè°ƒè¯•</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script src="js/modules/BackendManager.js"></script>
    <script src="reward-control.js"></script>
    <style>
        body {
            font-family: 'Comic Sans MS', 'Comic Neue', cursive;
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            color: #fff;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(31, 41, 55, 0.8);
            border-radius: 15px;
            padding: 30px;
            border: 3px solid #FFDD00;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #FFDD00;
            font-size: 2rem;
            font-weight: bold;
        }
        .section {
            background: rgba(17, 24, 39, 0.6);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #4CAF50;
        }
        .section h3 {
            color: #4CAF50;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        .button {
            background: linear-gradient(135deg, #FF9800, #F57C00);
            color: white;
            border: 3px solid #000;
            border-radius: 12px;
            padding: 12px 20px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            font-family: 'Comic Sans MS', 'Comic Neue', cursive;
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .result {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #FFDD00;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 0.9rem;
        }
        .success { border-left-color: #4CAF50; }
        .error { border-left-color: #f44336; }
        .warning { border-left-color: #FF9800; }
        .info { border-left-color: #2196F3; }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .full-width {
            grid-column: 1 / -1;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            margin: 5px;
        }
        .status.success { background: #4CAF50; }
        .status.error { background: #f44336; }
        .status.warning { background: #FF9800; }
        .status.info { background: #2196F3; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">ğŸ” å¥–åŠ±ç³»ç»Ÿæ•°æ®äº’é€šè°ƒè¯•</div>
        
        <div class="section">
            <h3>ğŸ¯ ç³»ç»Ÿåˆå§‹åŒ–æ£€æŸ¥</h3>
            <button class="button" onclick="checkSystemInitialization()">æ£€æŸ¥ç³»ç»Ÿåˆå§‹åŒ–</button>
            <button class="button" onclick="initializeSystems()">åˆå§‹åŒ–æ‰€æœ‰ç³»ç»Ÿ</button>
            <div id="init-result" class="result"></div>
        </div>

        <div class="grid">
            <div class="section">
                <h3>ğŸ† å¥–åŠ±æ§åˆ¶é¢æ¿çŠ¶æ€</h3>
                <button class="button" onclick="checkRewardControlPanel()">æ£€æŸ¥æ§åˆ¶é¢æ¿</button>
                <button class="button" onclick="testSetWinnerAddress()">æµ‹è¯•è®¾ç½®è·å¥–åœ°å€</button>
                <div id="control-panel-result" class="result"></div>
            </div>

            <div class="section">
                <h3>ğŸ é¢†å–é¡µé¢çŠ¶æ€</h3>
                <button class="button" onclick="checkClaimPage()">æ£€æŸ¥é¢†å–é¡µé¢</button>
                <button class="button" onclick="simulateWalletConnection()">æ¨¡æ‹Ÿé’±åŒ…è¿æ¥</button>
                <div id="claim-page-result" class="result"></div>
            </div>
        </div>

        <div class="section full-width">
            <h3>ğŸ“Š æ•°æ®å­˜å‚¨æ£€æŸ¥</h3>
            <button class="button" onclick="checkLocalStorage()">æ£€æŸ¥ localStorage</button>
            <button class="button" onclick="checkFirebase()">æ£€æŸ¥ Firebase</button>
            <button class="button" onclick="checkBackendManager()">æ£€æŸ¥ BackendManager</button>
            <div id="storage-result" class="result"></div>
        </div>

        <div class="section full-width">
            <h3>ğŸ”— æ•°æ®æµè¿½è¸ª</h3>
            <button class="button" onclick="traceDataFlow()">è¿½è¸ªæ•°æ®æµ</button>
            <button class="button" onclick="testDataInteroperability()">æµ‹è¯•æ•°æ®äº’é€š</button>
            <div id="data-flow-result" class="result"></div>
        </div>

        <div class="section full-width">
            <h3>ğŸ› ï¸ ä¿®å¤å·¥å…·</h3>
            <button class="button" onclick="fixDataInconsistency()">ä¿®å¤æ•°æ®ä¸ä¸€è‡´</button>
            <button class="button" onclick="syncAllData()">åŒæ­¥æ‰€æœ‰æ•°æ®</button>
            <button class="button" onclick="resetAllData()">é‡ç½®æ‰€æœ‰æ•°æ®</button>
            <div id="fix-result" class="result"></div>
        </div>
    </div>

    <script>
        let rewardControlPanel = null;
        let backendManager = null;

        // æ£€æŸ¥ç³»ç»Ÿåˆå§‹åŒ–
        function checkSystemInitialization() {
            const result = document.getElementById('init-result');
            let status = '';

            // æ£€æŸ¥ BackendManager
            if (typeof BackendManager !== 'undefined') {
                status += 'âœ… BackendManager ç±»å·²åŠ è½½\n';
            } else {
                status += 'âŒ BackendManager ç±»æœªåŠ è½½\n';
            }

            // æ£€æŸ¥ RewardControlPanel
            if (typeof RewardControlPanel !== 'undefined') {
                status += 'âœ… RewardControlPanel ç±»å·²åŠ è½½\n';
            } else {
                status += 'âŒ RewardControlPanel ç±»æœªåŠ è½½\n';
            }

            // æ£€æŸ¥ Firebase
            if (typeof firebase !== 'undefined') {
                status += 'âœ… Firebase SDK å·²åŠ è½½\n';
            } else {
                status += 'âŒ Firebase SDK æœªåŠ è½½\n';
            }

            // æ£€æŸ¥ localStorage
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                status += 'âœ… localStorage å¯ç”¨\n';
            } catch (e) {
                status += 'âŒ localStorage ä¸å¯ç”¨\n';
            }

            result.textContent = status;
            result.className = 'result info';
        }

        // åˆå§‹åŒ–æ‰€æœ‰ç³»ç»Ÿ
        async function initializeSystems() {
            const result = document.getElementById('init-result');
            result.textContent = 'æ­£åœ¨åˆå§‹åŒ–ç³»ç»Ÿ...\n';
            result.className = 'result info';

            try {
                // åˆå§‹åŒ– BackendManager
                if (typeof BackendManager !== 'undefined') {
                    backendManager = new BackendManager();
                    backendManager.init();
                    result.textContent += 'âœ… BackendManager åˆå§‹åŒ–æˆåŠŸ\n';
                }

                // åˆå§‹åŒ– RewardControlPanel
                if (typeof RewardControlPanel !== 'undefined') {
                    rewardControlPanel = new RewardControlPanel();
                    await rewardControlPanel.init();
                    result.textContent += 'âœ… RewardControlPanel åˆå§‹åŒ–æˆåŠŸ\n';
                }

                result.textContent += 'ğŸ‰ æ‰€æœ‰ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼';
                result.className = 'result success';
            } catch (error) {
                result.textContent += `âŒ åˆå§‹åŒ–å¤±è´¥: ${error.message}`;
                result.className = 'result error';
            }
        }

        // æ£€æŸ¥å¥–åŠ±æ§åˆ¶é¢æ¿
        function checkRewardControlPanel() {
            const result = document.getElementById('control-panel-result');
            
            if (!rewardControlPanel) {
                result.textContent = 'âŒ RewardControlPanel æœªåˆå§‹åŒ–';
                result.className = 'result error';
                return;
            }

            try {
                const status = rewardControlPanel.getSystemStatus();
                result.textContent = JSON.stringify(status, null, 2);
                result.className = 'result success';
            } catch (error) {
                result.textContent = `âŒ æ£€æŸ¥å¤±è´¥: ${error.message}`;
                result.className = 'result error';
            }
        }

        // æµ‹è¯•è®¾ç½®è·å¥–åœ°å€
        async function testSetWinnerAddress() {
            const result = document.getElementById('control-panel-result');
            
            if (!rewardControlPanel) {
                result.textContent = 'âŒ RewardControlPanel æœªåˆå§‹åŒ–';
                result.className = 'result error';
                return;
            }

            try {
                const testAddress = 'zeKuzxAQ2ZeMGDnptUncbXvEYQKKaKYNLygZQANbM2A';
                await rewardControlPanel.setWinnerAddress(testAddress, 100000);
                result.textContent = `âœ… æµ‹è¯•åœ°å€è®¾ç½®æˆåŠŸ: ${testAddress}`;
                result.className = 'result success';
            } catch (error) {
                result.textContent = `âŒ è®¾ç½®å¤±è´¥: ${error.message}`;
                result.className = 'result error';
            }
        }

        // æ£€æŸ¥é¢†å–é¡µé¢
        function checkClaimPage() {
            const result = document.getElementById('claim-page-result');
            
            // æ¨¡æ‹Ÿ claim-reward.html çš„é€»è¾‘
            const rewardAddressData = localStorage.getItem('mainCountdownRewardAddress');
            const mainCountdownRewards = JSON.parse(localStorage.getItem('mainCountdownRewards') || '[]');
            
            let status = '';
            
            if (rewardAddressData) {
                const rewardConfig = JSON.parse(rewardAddressData);
                status += `ğŸ† è·å¥–åœ°å€: ${rewardConfig.address}\n`;
                status += `ğŸ’° å¥–åŠ±é‡‘é¢: ${rewardConfig.amount}\n`;
                status += `âœ… æ˜¯å¦è®¾ç½®: ${rewardConfig.isSet}\n\n`;
            } else {
                status += 'âŒ æœªæ‰¾åˆ°è·å¥–åœ°å€é…ç½®\n\n';
            }
            
            status += `ğŸ“Š å¥–åŠ±è®°å½•æ€»æ•°: ${mainCountdownRewards.length}\n`;
            const unclaimedRewards = mainCountdownRewards.filter(r => !r.claimed);
            status += `ğŸ å¾…é¢†å–å¥–åŠ±: ${unclaimedRewards.length}\n`;
            
            result.textContent = status;
            result.className = 'result info';
        }

        // æ¨¡æ‹Ÿé’±åŒ…è¿æ¥
        function simulateWalletConnection() {
            const result = document.getElementById('claim-page-result');
            
            // æ¨¡æ‹Ÿè¿æ¥çš„é’±åŒ…åœ°å€
            const simulatedWalletAddress = 'zeKuzxAQ2ZeMGDnptUncbXvEYQKKaKYNLygZQANbM2A';
            
            // ä¿å­˜æ¨¡æ‹Ÿè¿æ¥
            localStorage.setItem('walletConnection', JSON.stringify({
                address: simulatedWalletAddress,
                connectedAt: new Date().toISOString()
            }));
            
            // æ£€æŸ¥æ˜¯å¦åŒ¹é…è·å¥–åœ°å€
            const rewardAddressData = localStorage.getItem('mainCountdownRewardAddress');
            if (rewardAddressData) {
                const rewardConfig = JSON.parse(rewardAddressData);
                const isMatch = rewardConfig.address === simulatedWalletAddress;
                
                result.textContent = `ğŸ”— æ¨¡æ‹Ÿé’±åŒ…è¿æ¥: ${simulatedWalletAddress}\n`;
                result.textContent += `ğŸ” åœ°å€åŒ¹é…: ${isMatch ? 'âœ… æ˜¯' : 'âŒ å¦'}\n`;
                result.textContent += `ğŸ å¯é¢†å–çŠ¶æ€: ${isMatch ? 'âœ… å¯é¢†å–' : 'âŒ ä¸å¯é¢†å–'}`;
                
                result.className = isMatch ? 'result success' : 'result warning';
            } else {
                result.textContent = 'âŒ æœªæ‰¾åˆ°è·å¥–åœ°å€é…ç½®';
                result.className = 'result error';
            }
        }

        // æ£€æŸ¥ localStorage
        function checkLocalStorage() {
            const result = document.getElementById('storage-result');
            
            const keys = [
                'mainCountdownRewardAddress',
                'mainCountdownRewards',
                'walletConnection',
                'memeCoinAdminConfig'
            ];
            
            let status = 'ğŸ“± localStorage æ£€æŸ¥ç»“æœ:\n\n';
            
            keys.forEach(key => {
                const value = localStorage.getItem(key);
                if (value) {
                    try {
                        const parsed = JSON.parse(value);
                        status += `âœ… ${key}: å­˜åœ¨ (${typeof parsed})\n`;
                    } catch (e) {
                        status += `âš ï¸ ${key}: å­˜åœ¨ä½†æ ¼å¼é”™è¯¯\n`;
                    }
                } else {
                    status += `âŒ ${key}: ä¸å­˜åœ¨\n`;
                }
            });
            
            result.textContent = status;
            result.className = 'result info';
        }

        // æ£€æŸ¥ Firebase
        async function checkFirebase() {
            const result = document.getElementById('storage-result');
            
            if (typeof firebase === 'undefined') {
                result.textContent = 'âŒ Firebase SDK æœªåŠ è½½';
                result.className = 'result error';
                return;
            }
            
            try {
                const firebaseConfig = {
                    apiKey: "AIzaSyA5Z5ieEbAcfQX0kxGSn9ldGXhzvAwx_8M",
                    authDomain: "chat-294cc.firebaseapp.com",
                    databaseURL: "https://chat-294cc-default-rtdb.firebaseio.com",
                    projectId: "chat-294cc",
                    storageBucket: "chat-294cc.firebasestorage.app",
                    messagingSenderId: "913615304269",
                    appId: "1:913615304269:web:0274ffaccb8e6b678e4e04",
                    measurementId: "G-SJR9NDW86B"
                };
                
                const app = firebase.initializeApp(firebaseConfig);
                const database = firebase.database(app);
                
                // æ£€æŸ¥è¿æ¥
                const connectedRef = database.ref('.info/connected');
                const snapshot = await connectedRef.once('value');
                const isConnected = snapshot.val();
                
                result.textContent = `ğŸ”¥ Firebase è¿æ¥çŠ¶æ€: ${isConnected ? 'âœ… å·²è¿æ¥' : 'âŒ æœªè¿æ¥'}\n`;
                
                if (isConnected) {
                    // æ£€æŸ¥æ•°æ®
                    const mainCountdownRef = database.ref('mainCountdownRewards');
                    const dataSnapshot = await mainCountdownRef.once('value');
                    const data = dataSnapshot.val();
                    
                    if (data) {
                        result.textContent += `ğŸ“Š Firebase æ•°æ®: å­˜åœ¨\n`;
                        result.textContent += JSON.stringify(data, null, 2);
                    } else {
                        result.textContent += `ğŸ“Š Firebase æ•°æ®: ä¸å­˜åœ¨`;
                    }
                }
                
                result.className = 'result info';
            } catch (error) {
                result.textContent = `âŒ Firebase æ£€æŸ¥å¤±è´¥: ${error.message}`;
                result.className = 'result error';
            }
        }

        // æ£€æŸ¥ BackendManager
        function checkBackendManager() {
            const result = document.getElementById('storage-result');
            
            if (!backendManager) {
                result.textContent = 'âŒ BackendManager æœªåˆå§‹åŒ–';
                result.className = 'result error';
                return;
            }
            
            try {
                const config = backendManager.getConfig();
                const rewardAddress = backendManager.getMainCountdownRewardAddress();
                
                result.textContent = 'ğŸ”§ BackendManager çŠ¶æ€:\n\n';
                result.textContent += `ğŸ“‹ é…ç½®åŠ è½½: âœ…\n`;
                result.textContent += `ğŸ† è·å¥–åœ°å€: ${rewardAddress ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®'}\n`;
                result.textContent += `ğŸ”¥ Firebase: ${backendManager.firebaseEnabled ? 'å¯ç”¨' : 'ç¦ç”¨'}\n`;
                
                if (rewardAddress) {
                    result.textContent += `\nè·å¥–åœ°å€è¯¦æƒ…:\n`;
                    result.textContent += JSON.stringify(rewardAddress, null, 2);
                }
                
                result.className = 'result success';
            } catch (error) {
                result.textContent = `âŒ BackendManager æ£€æŸ¥å¤±è´¥: ${error.message}`;
                result.className = 'result error';
            }
        }

        // è¿½è¸ªæ•°æ®æµ
        function traceDataFlow() {
            const result = document.getElementById('data-flow-result');
            
            let trace = 'ğŸ”„ æ•°æ®æµè¿½è¸ª:\n\n';
            
            // 1. æ§åˆ¶é¢æ¿è®¾ç½®
            trace += '1ï¸âƒ£ æ§åˆ¶é¢æ¿è®¾ç½®æµç¨‹:\n';
            trace += '   RewardControlPanel.setWinnerAddress() â†’\n';
            trace += '   BackendManager.setMainCountdownRewardAddress() â†’\n';
            trace += '   localStorage.setItem("mainCountdownRewardAddress") â†’\n';
            trace += '   Firebase database.ref("mainCountdownRewards").set()\n\n';
            
            // 2. é¢†å–é¡µé¢æ£€æŸ¥
            trace += '2ï¸âƒ£ é¢†å–é¡µé¢æ£€æŸ¥æµç¨‹:\n';
            trace += '   localStorage.getItem("mainCountdownRewardAddress") â†’\n';
            trace += '   æ£€æŸ¥é’±åŒ…åœ°å€åŒ¹é… â†’\n';
            trace += '   åˆ›å»º/æ£€æŸ¥å¥–åŠ±è®°å½• â†’\n';
            trace += '   æ˜¾ç¤ºå¯é¢†å–çŠ¶æ€\n\n';
            
            // 3. å½“å‰çŠ¶æ€æ£€æŸ¥
            trace += '3ï¸âƒ£ å½“å‰æ•°æ®çŠ¶æ€:\n';
            
            const rewardAddressData = localStorage.getItem('mainCountdownRewardAddress');
            if (rewardAddressData) {
                const rewardConfig = JSON.parse(rewardAddressData);
                trace += `   âœ… è·å¥–åœ°å€é…ç½®: ${rewardConfig.address}\n`;
            } else {
                trace += `   âŒ è·å¥–åœ°å€é…ç½®: ä¸å­˜åœ¨\n`;
            }
            
            const mainCountdownRewards = JSON.parse(localStorage.getItem('mainCountdownRewards') || '[]');
            trace += `   ğŸ“Š å¥–åŠ±è®°å½•: ${mainCountdownRewards.length} æ¡\n`;
            
            const walletConnection = localStorage.getItem('walletConnection');
            if (walletConnection) {
                const connection = JSON.parse(walletConnection);
                trace += `   ğŸ”— é’±åŒ…è¿æ¥: ${connection.address}\n`;
            } else {
                trace += `   âŒ é’±åŒ…è¿æ¥: æœªè¿æ¥\n`;
            }
            
            result.textContent = trace;
            result.className = 'result info';
        }

        // æµ‹è¯•æ•°æ®äº’é€š
        function testDataInteroperability() {
            const result = document.getElementById('data-flow-result');
            
            let test = 'ğŸ§ª æ•°æ®äº’é€šæµ‹è¯•:\n\n';
            
            // æµ‹è¯• 1: æ§åˆ¶é¢æ¿ â†’ localStorage
            const rewardAddressData = localStorage.getItem('mainCountdownRewardAddress');
            if (rewardAddressData) {
                test += 'âœ… æµ‹è¯•1: æ§åˆ¶é¢æ¿ â†’ localStorage âœ“\n';
            } else {
                test += 'âŒ æµ‹è¯•1: æ§åˆ¶é¢æ¿ â†’ localStorage âœ—\n';
            }
            
            // æµ‹è¯• 2: localStorage â†’ é¢†å–é¡µé¢
            const mainCountdownRewards = JSON.parse(localStorage.getItem('mainCountdownRewards') || '[]');
            if (mainCountdownRewards.length > 0) {
                test += 'âœ… æµ‹è¯•2: localStorage â†’ é¢†å–é¡µé¢ âœ“\n';
            } else {
                test += 'âŒ æµ‹è¯•2: localStorage â†’ é¢†å–é¡µé¢ âœ—\n';
            }
            
            // æµ‹è¯• 3: é’±åŒ…è¿æ¥ â†’ åœ°å€åŒ¹é…
            const walletConnection = localStorage.getItem('walletConnection');
            if (walletConnection && rewardAddressData) {
                const connection = JSON.parse(walletConnection);
                const rewardConfig = JSON.parse(rewardAddressData);
                const isMatch = connection.address === rewardConfig.address;
                
                if (isMatch) {
                    test += 'âœ… æµ‹è¯•3: é’±åŒ…è¿æ¥ â†’ åœ°å€åŒ¹é… âœ“\n';
                } else {
                    test += 'âš ï¸ æµ‹è¯•3: é’±åŒ…è¿æ¥ â†’ åœ°å€ä¸åŒ¹é…\n';
                }
            } else {
                test += 'âŒ æµ‹è¯•3: é’±åŒ…è¿æ¥ â†’ åœ°å€åŒ¹é… âœ—\n';
            }
            
            // æµ‹è¯• 4: BackendManager ä¸€è‡´æ€§
            if (backendManager) {
                const bmRewardAddress = backendManager.getMainCountdownRewardAddress();
                if (bmRewardAddress && rewardAddressData) {
                    const bmConfig = bmRewardAddress;
                    const lsConfig = JSON.parse(rewardAddressData);
                    
                    if (bmConfig.address === lsConfig.address) {
                        test += 'âœ… æµ‹è¯•4: BackendManager ä¸€è‡´æ€§ âœ“\n';
                    } else {
                        test += 'âŒ æµ‹è¯•4: BackendManager ä¸ä¸€è‡´ âœ—\n';
                    }
                } else {
                    test += 'âŒ æµ‹è¯•4: BackendManager ä¸€è‡´æ€§ âœ—\n';
                }
            } else {
                test += 'âŒ æµ‹è¯•4: BackendManager ä¸€è‡´æ€§ âœ—\n';
            }
            
            result.textContent = test;
            result.className = 'result info';
        }

        // ä¿®å¤æ•°æ®ä¸ä¸€è‡´
        function fixDataInconsistency() {
            const result = document.getElementById('fix-result');
            
            try {
                // ç¡®ä¿ BackendManager å’Œ localStorage ä¸€è‡´
                if (backendManager) {
                    const bmRewardAddress = backendManager.getMainCountdownRewardAddress();
                    if (bmRewardAddress) {
                        localStorage.setItem('mainCountdownRewardAddress', JSON.stringify(bmRewardAddress));
                        result.textContent = 'âœ… å·²åŒæ­¥ BackendManager æ•°æ®åˆ° localStorage';
                    } else {
                        result.textContent = 'âš ï¸ BackendManager ä¸­æ²¡æœ‰è·å¥–åœ°å€æ•°æ®';
                    }
                } else {
                    result.textContent = 'âŒ BackendManager æœªåˆå§‹åŒ–';
                }
                
                result.className = 'result success';
            } catch (error) {
                result.textContent = `âŒ ä¿®å¤å¤±è´¥: ${error.message}`;
                result.className = 'result error';
            }
        }

        // åŒæ­¥æ‰€æœ‰æ•°æ®
        async function syncAllData() {
            const result = document.getElementById('fix-result');
            
            try {
                if (backendManager) {
                    await backendManager.syncAllToFirebase();
                    result.textContent = 'âœ… æ‰€æœ‰æ•°æ®å·²åŒæ­¥åˆ° Firebase';
                } else {
                    result.textContent = 'âŒ BackendManager æœªåˆå§‹åŒ–';
                }
                
                result.className = 'result success';
            } catch (error) {
                result.textContent = `âŒ åŒæ­¥å¤±è´¥: ${error.message}`;
                result.className = 'result error';
            }
        }

        // é‡ç½®æ‰€æœ‰æ•°æ®
        function resetAllData() {
            const result = document.getElementById('fix-result');
            
            try {
                // æ¸…é™¤æ‰€æœ‰ç›¸å…³æ•°æ®
                localStorage.removeItem('mainCountdownRewardAddress');
                localStorage.removeItem('mainCountdownRewards');
                localStorage.removeItem('walletConnection');
                
                result.textContent = 'âœ… æ‰€æœ‰å¥–åŠ±ç›¸å…³æ•°æ®å·²é‡ç½®';
                result.className = 'result success';
            } catch (error) {
                result.textContent = `âŒ é‡ç½®å¤±è´¥: ${error.message}`;
                result.className = 'result error';
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            checkSystemInitialization();
        });
    </script>
</body>
</html> 