<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡å—åŠ è½½è¯Šæ–­å™¨</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .status-item {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .status-item.error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .status-item.success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .status-item.warning {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        .status-label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .status-value {
            font-family: monospace;
            color: #666;
            font-size: 12px;
        }
        .action-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .action-btn:hover {
            background: #0056b3;
        }
        .action-btn.danger {
            background: #dc3545;
        }
        .action-btn.danger:hover {
            background: #c82333;
        }
        .action-btn.success {
            background: #28a745;
        }
        .action-btn.success:hover {
            background: #218838;
        }
        .log-container {
            background: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .module-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .module-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: #f8f9fa;
        }
        .module-card.loaded {
            border-color: #28a745;
            background: #d4edda;
        }
        .module-card.error {
            border-color: #dc3545;
            background: #f8d7da;
        }
        .module-name {
            font-weight: bold;
            margin-bottom: 10px;
        }
        .module-status {
            font-size: 12px;
            margin-bottom: 5px;
        }
        .module-details {
            font-size: 11px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ æ¨¡å—åŠ è½½è¯Šæ–­å™¨</h1>
        <p>è¯Šæ–­ä¸ºä»€ä¹ˆäº¤æ˜“æ£€æµ‹æ¨¡å—æ²¡æœ‰æ­£ç¡®åŠ è½½</p>

        <!-- æ¨¡å—åŠ è½½çŠ¶æ€ -->
        <div class="section">
            <h2>ğŸ“¦ æ¨¡å—åŠ è½½çŠ¶æ€</h2>
            <div id="moduleStatus">
                æ­£åœ¨æ£€æŸ¥æ¨¡å—åŠ è½½çŠ¶æ€...
            </div>
            <button class="action-btn" onclick="checkModuleLoading()">åˆ·æ–°æ¨¡å—çŠ¶æ€</button>
            <button class="action-btn success" onclick="loadAllModules()">é‡æ–°åŠ è½½æ‰€æœ‰æ¨¡å—</button>
            <button class="action-btn danger" onclick="clearModules()">æ¸…é™¤æ¨¡å—ç¼“å­˜</button>
        </div>

        <!-- è„šæœ¬åŠ è½½æ£€æŸ¥ -->
        <div class="section">
            <h2>ğŸ“œ è„šæœ¬åŠ è½½æ£€æŸ¥</h2>
            <div id="scriptStatus">
                æ­£åœ¨æ£€æŸ¥è„šæœ¬åŠ è½½çŠ¶æ€...
            </div>
            <button class="action-btn" onclick="checkScriptLoading()">åˆ·æ–°è„šæœ¬çŠ¶æ€</button>
        </div>

        <!-- å…¨å±€å¯¹è±¡æ£€æŸ¥ -->
        <div class="section">
            <h2>ğŸŒ å…¨å±€å¯¹è±¡æ£€æŸ¥</h2>
            <div id="globalObjectStatus">
                æ­£åœ¨æ£€æŸ¥å…¨å±€å¯¹è±¡...
            </div>
            <button class="action-btn" onclick="checkGlobalObjects()">åˆ·æ–°å…¨å±€å¯¹è±¡</button>
        </div>

        <!-- é”™è¯¯æ—¥å¿— -->
        <div class="section">
            <h2>ğŸ“ é”™è¯¯æ—¥å¿—</h2>
            <button class="action-btn" onclick="clearErrorLog()">æ¸…ç©ºæ—¥å¿—</button>
            <button class="action-btn" onclick="exportErrorLog()">å¯¼å‡ºæ—¥å¿—</button>
            <div id="errorLogContainer" class="log-container">
                ç­‰å¾…é”™è¯¯æ—¥å¿—...
            </div>
        </div>

        <!-- æ‰‹åŠ¨æ¨¡å—åŠ è½½ -->
        <div class="section">
            <h2>ğŸ”§ æ‰‹åŠ¨æ¨¡å—åŠ è½½</h2>
            <div class="module-list" id="moduleList">
                æ­£åœ¨ç”Ÿæˆæ¨¡å—åˆ—è¡¨...
            </div>
        </div>

        <!-- åº”ç”¨åˆå§‹åŒ– -->
        <div class="section">
            <h2>ğŸš€ åº”ç”¨åˆå§‹åŒ–</h2>
            <div id="appInitStatus">
                æ£€æŸ¥åº”ç”¨åˆå§‹åŒ–çŠ¶æ€...
            </div>
            <button class="action-btn" onclick="initializeApp()">åˆå§‹åŒ–åº”ç”¨</button>
            <button class="action-btn" onclick="restartApp()">é‡å¯åº”ç”¨</button>
        </div>
    </div>

    <!-- åŠ è½½å¿…è¦çš„è„šæœ¬ -->
    <script src="https://unpkg.com/@solana/web3.js@1.87.6/lib/index.iife.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        let errorLog = [];
        let moduleLoadAttempts = {};

        // æ·»åŠ é”™è¯¯æ—¥å¿—
        function addErrorLog(message, type = 'error') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            errorLog.push(logEntry);
            
            const logContainer = document.getElementById('errorLogContainer');
            logContainer.textContent = errorLog.join('\n');
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // æ£€æŸ¥æ¨¡å—åŠ è½½çŠ¶æ€
        function checkModuleLoading() {
            addErrorLog('æ£€æŸ¥æ¨¡å—åŠ è½½çŠ¶æ€...', 'info');
            
            const modules = [
                'CountdownManager',
                'TransactionTracker', 
                'UIEffects',
                'BackendManager',
                'TokenHoldersManager',
                'WalletManager',
                'WhitepaperModal',
                'ClaimRewardModal',
                'MemeCoinApp'
            ];
            
            const statusDiv = document.getElementById('moduleStatus');
            let statusHtml = '';
            
            modules.forEach(moduleName => {
                const isLoaded = typeof window[moduleName] !== 'undefined';
                const status = isLoaded ? 'success' : 'error';
                const label = isLoaded ? 'âœ…' : 'âŒ';
                
                statusHtml += `
                    <div class="status-item ${status}">
                        <div class="status-label">${label} ${moduleName}</div>
                        <div class="status-value">çŠ¶æ€: ${isLoaded ? 'å·²åŠ è½½' : 'æœªåŠ è½½'}</div>
                        <div class="status-value">ç±»å‹: ${isLoaded ? typeof window[moduleName] : 'undefined'}</div>
                    </div>
                `;
                
                if (!isLoaded) {
                    addErrorLog(`æ¨¡å— ${moduleName} æœªåŠ è½½`, 'error');
                } else {
                    addErrorLog(`æ¨¡å— ${moduleName} å·²åŠ è½½`, 'success');
                }
            });
            
            statusDiv.innerHTML = statusHtml;
        }

        // æ£€æŸ¥è„šæœ¬åŠ è½½çŠ¶æ€
        function checkScriptLoading() {
            addErrorLog('æ£€æŸ¥è„šæœ¬åŠ è½½çŠ¶æ€...', 'info');
            
            const scripts = [
                'js/modules/Utils.js',
                'js/modules/CountdownManager.js',
                'js/modules/TransactionTracker.js',
                'js/modules/UIEffects.js',
                'js/modules/BackendManager.js',
                'js/modules/TokenHoldersManager.js',
                'js/modules/WalletManager.js',
                'js/modules/WhitepaperModal.js',
                'js/modules/ClaimRewardModal.js',
                'js/app.js'
            ];
            
            const statusDiv = document.getElementById('scriptStatus');
            let statusHtml = '';
            
            scripts.forEach(scriptPath => {
                const scriptElement = document.querySelector(`script[src="${scriptPath}"]`);
                const isLoaded = scriptElement !== null;
                const status = isLoaded ? 'success' : 'error';
                const label = isLoaded ? 'âœ…' : 'âŒ';
                
                statusHtml += `
                    <div class="status-item ${status}">
                        <div class="status-label">${label} ${scriptPath}</div>
                        <div class="status-value">çŠ¶æ€: ${isLoaded ? 'å·²åŠ è½½' : 'æœªæ‰¾åˆ°'}</div>
                    </div>
                `;
                
                if (!isLoaded) {
                    addErrorLog(`è„šæœ¬ ${scriptPath} æœªæ‰¾åˆ°`, 'error');
                } else {
                    addErrorLog(`è„šæœ¬ ${scriptPath} å·²åŠ è½½`, 'success');
                }
            });
            
            statusDiv.innerHTML = statusHtml;
        }

        // æ£€æŸ¥å…¨å±€å¯¹è±¡
        function checkGlobalObjects() {
            addErrorLog('æ£€æŸ¥å…¨å±€å¯¹è±¡...', 'info');
            
            const globalObjects = [
                'solana',
                'firebase',
                'database',
                'window.backendManager',
                'window.transactionTracker',
                'window.memeCoinApp'
            ];
            
            const statusDiv = document.getElementById('globalObjectStatus');
            let statusHtml = '';
            
            globalObjects.forEach(objName => {
                let isAvailable = false;
                let value = 'undefined';
                
                try {
                    if (objName.includes('.')) {
                        const parts = objName.split('.');
                        let current = window;
                        for (const part of parts) {
                            current = current[part];
                            if (current === undefined) break;
                        }
                        isAvailable = current !== undefined;
                        value = typeof current;
                    } else {
                        isAvailable = typeof window[objName] !== 'undefined';
                        value = typeof window[objName];
                    }
                } catch (error) {
                    isAvailable = false;
                    value = 'error: ' + error.message;
                }
                
                const status = isAvailable ? 'success' : 'error';
                const label = isAvailable ? 'âœ…' : 'âŒ';
                
                statusHtml += `
                    <div class="status-item ${status}">
                        <div class="status-label">${label} ${objName}</div>
                        <div class="status-value">çŠ¶æ€: ${isAvailable ? 'å¯ç”¨' : 'ä¸å¯ç”¨'}</div>
                        <div class="status-value">ç±»å‹: ${value}</div>
                    </div>
                `;
                
                if (!isAvailable) {
                    addErrorLog(`å…¨å±€å¯¹è±¡ ${objName} ä¸å¯ç”¨`, 'error');
                } else {
                    addErrorLog(`å…¨å±€å¯¹è±¡ ${objName} å¯ç”¨`, 'success');
                }
            });
            
            statusDiv.innerHTML = statusHtml;
        }

        // é‡æ–°åŠ è½½æ‰€æœ‰æ¨¡å—
        function loadAllModules() {
            addErrorLog('é‡æ–°åŠ è½½æ‰€æœ‰æ¨¡å—...', 'info');
            
            const scripts = [
                'js/modules/Utils.js',
                'js/modules/CountdownManager.js',
                'js/modules/TransactionTracker.js',
                'js/modules/UIEffects.js',
                'js/modules/BackendManager.js',
                'js/modules/TokenHoldersManager.js',
                'js/modules/WalletManager.js',
                'js/modules/WhitepaperModal.js',
                'js/modules/ClaimRewardModal.js',
                'js/app.js'
            ];
            
            scripts.forEach((scriptPath, index) => {
                setTimeout(() => {
                    loadScript(scriptPath);
                }, index * 500);
            });
        }

        // åŠ è½½å•ä¸ªè„šæœ¬
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = () => {
                    addErrorLog(`è„šæœ¬ ${src} åŠ è½½æˆåŠŸ`, 'success');
                    resolve();
                };
                script.onerror = () => {
                    addErrorLog(`è„šæœ¬ ${src} åŠ è½½å¤±è´¥`, 'error');
                    reject(new Error(`Failed to load ${src}`));
                };
                document.head.appendChild(script);
            });
        }

        // æ¸…é™¤æ¨¡å—ç¼“å­˜
        function clearModules() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ¨¡å—ç¼“å­˜å—ï¼Ÿè¿™å°†é‡æ–°åŠ è½½æ‰€æœ‰æ¨¡å—ã€‚')) {
                addErrorLog('æ¸…é™¤æ¨¡å—ç¼“å­˜...', 'warning');
                
                // æ¸…é™¤å…¨å±€å¯¹è±¡
                delete window.backendManager;
                delete window.transactionTracker;
                delete window.memeCoinApp;
                
                // é‡æ–°åŠ è½½æ¨¡å—
                setTimeout(() => {
                    loadAllModules();
                }, 1000);
            }
        }

        // æ¸…ç©ºé”™è¯¯æ—¥å¿—
        function clearErrorLog() {
            errorLog = [];
            document.getElementById('errorLogContainer').textContent = 'æ—¥å¿—å·²æ¸…ç©º...';
        }

        // å¯¼å‡ºé”™è¯¯æ—¥å¿—
        function exportErrorLog() {
            const logText = errorLog.join('\n');
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `module-loader-debug-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            addErrorLog('é”™è¯¯æ—¥å¿—å·²å¯¼å‡º', 'info');
        }

        // ç”Ÿæˆæ¨¡å—åˆ—è¡¨
        function generateModuleList() {
            const modules = [
                { name: 'CountdownManager', path: 'js/modules/CountdownManager.js' },
                { name: 'TransactionTracker', path: 'js/modules/TransactionTracker.js' },
                { name: 'UIEffects', path: 'js/modules/UIEffects.js' },
                { name: 'BackendManager', path: 'js/modules/BackendManager.js' },
                { name: 'TokenHoldersManager', path: 'js/modules/TokenHoldersManager.js' },
                { name: 'WalletManager', path: 'js/modules/WalletManager.js' },
                { name: 'WhitepaperModal', path: 'js/modules/WhitepaperModal.js' },
                { name: 'ClaimRewardModal', path: 'js/modules/ClaimRewardModal.js' }
            ];
            
            const listDiv = document.getElementById('moduleList');
            let listHtml = '';
            
            modules.forEach(module => {
                const isLoaded = typeof window[module.name] !== 'undefined';
                const cardClass = isLoaded ? 'loaded' : 'error';
                const status = isLoaded ? 'å·²åŠ è½½' : 'æœªåŠ è½½';
                
                listHtml += `
                    <div class="module-card ${cardClass}">
                        <div class="module-name">${module.name}</div>
                        <div class="module-status">çŠ¶æ€: ${status}</div>
                        <div class="module-details">è·¯å¾„: ${module.path}</div>
                        <button class="action-btn" onclick="loadSingleModule('${module.name}', '${module.path}')">
                            é‡æ–°åŠ è½½
                        </button>
                    </div>
                `;
            });
            
            listDiv.innerHTML = listHtml;
        }

        // åŠ è½½å•ä¸ªæ¨¡å—
        function loadSingleModule(moduleName, scriptPath) {
            addErrorLog(`é‡æ–°åŠ è½½æ¨¡å— ${moduleName}...`, 'info');
            
            // åˆ é™¤ç°æœ‰æ¨¡å—
            delete window[moduleName];
            
            // åŠ è½½è„šæœ¬
            loadScript(scriptPath).then(() => {
                addErrorLog(`æ¨¡å— ${moduleName} é‡æ–°åŠ è½½æˆåŠŸ`, 'success');
                generateModuleList();
                checkModuleLoading();
            }).catch(error => {
                addErrorLog(`æ¨¡å— ${moduleName} é‡æ–°åŠ è½½å¤±è´¥: ${error.message}`, 'error');
            });
        }

        // åˆå§‹åŒ–åº”ç”¨
        function initializeApp() {
            addErrorLog('åˆå§‹åŒ–åº”ç”¨...', 'info');
            
            if (typeof MemeCoinApp !== 'undefined') {
                try {
                    window.memeCoinApp = new MemeCoinApp();
                    addErrorLog('åº”ç”¨åˆå§‹åŒ–æˆåŠŸ', 'success');
                    checkAppInitStatus();
                } catch (error) {
                    addErrorLog(`åº”ç”¨åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                }
            } else {
                addErrorLog('MemeCoinApp ç±»æœªå®šä¹‰ï¼Œæ— æ³•åˆå§‹åŒ–', 'error');
            }
        }

        // é‡å¯åº”ç”¨
        function restartApp() {
            if (confirm('ç¡®å®šè¦é‡å¯åº”ç”¨å—ï¼Ÿ')) {
                addErrorLog('é‡å¯åº”ç”¨...', 'warning');
                
                // é”€æ¯ç°æœ‰åº”ç”¨
                if (window.memeCoinApp && typeof window.memeCoinApp.destroy === 'function') {
                    window.memeCoinApp.destroy();
                }
                
                // æ¸…é™¤å…¨å±€å¯¹è±¡
                delete window.memeCoinApp;
                
                // é‡æ–°åˆå§‹åŒ–
                setTimeout(() => {
                    initializeApp();
                }, 1000);
            }
        }

        // æ£€æŸ¥åº”ç”¨åˆå§‹åŒ–çŠ¶æ€
        function checkAppInitStatus() {
            const statusDiv = document.getElementById('appInitStatus');
            
            if (window.memeCoinApp) {
                const isInitialized = window.memeCoinApp.isInitialized;
                const status = isInitialized ? 'success' : 'warning';
                const label = isInitialized ? 'âœ…' : 'âš ï¸';
                
                statusDiv.innerHTML = `
                    <div class="status-item ${status}">
                        <div class="status-label">${label} åº”ç”¨çŠ¶æ€</div>
                        <div class="status-value">åˆå§‹åŒ–çŠ¶æ€: ${isInitialized ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–'}</div>
                        <div class="status-value">æ¨¡å—æ•°é‡: ${Object.keys(window.memeCoinApp.modules || {}).length}</div>
                    </div>
                `;
                
                addErrorLog(`åº”ç”¨çŠ¶æ€: ${isInitialized ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–'}`, isInitialized ? 'success' : 'warning');
            } else {
                statusDiv.innerHTML = `
                    <div class="status-item error">
                        <div class="status-label">âŒ åº”ç”¨çŠ¶æ€</div>
                        <div class="status-value">åº”ç”¨æœªåˆ›å»º</div>
                    </div>
                `;
                addErrorLog('åº”ç”¨æœªåˆ›å»º', 'error');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', () => {
            addErrorLog('æ¨¡å—åŠ è½½è¯Šæ–­å™¨å·²å¯åŠ¨', 'info');
            
            // æ‰§è¡Œåˆå§‹æ£€æŸ¥
            checkModuleLoading();
            checkScriptLoading();
            checkGlobalObjects();
            generateModuleList();
            checkAppInitStatus();
            
            // è®¾ç½®å®šæ—¶åˆ·æ–°
            setInterval(() => {
                checkModuleLoading();
                checkAppInitStatus();
            }, 10000); // æ¯10ç§’åˆ·æ–°ä¸€æ¬¡
        });
    </script>
</body>
</html> 