<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>最终模块验证工具</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .module-card {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .module-card.success {
            border-color: #48bb78;
            background: #f0fff4;
        }
        
        .module-card.error {
            border-color: #f56565;
            background: #fff5f5;
        }
        
        .module-card.loading {
            border-color: #ed8936;
            background: #fffaf0;
        }
        
        .module-name {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #2d3748;
        }
        
        .module-status {
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .module-details {
            font-size: 0.8em;
            color: #718096;
            margin-top: 10px;
        }
        
        .test-section {
            background: #edf2f7;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .test-section h3 {
            color: #2d3748;
            margin-bottom: 15px;
        }
        
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .test-button:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }
        
        .result-area {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .summary {
            background: #e6fffa;
            border: 2px solid #4fd1c7;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .summary h3 {
            color: #2c7a7b;
            margin-bottom: 15px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #b2f5ea;
        }
        
        .summary-label {
            font-weight: bold;
            color: #2c7a7b;
        }
        
        .summary-value {
            color: #319795;
        }
        
        .success-text {
            color: #38a169;
        }
        
        .error-text {
            color: #e53e3e;
        }
        
        .warning-text {
            color: #d69e2e;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔧 最终模块验证工具</h1>
        
        <div class="status-grid" id="moduleGrid">
            <!-- 模块状态将在这里动态生成 -->
        </div>
        
        <div class="test-section">
            <h3>🧪 功能测试</h3>
            <button class="test-button" onclick="testAllModules()">测试所有模块</button>
            <button class="test-button" onclick="testTransactionDetection()">测试交易检测</button>
            <button class="test-button" onclick="testAppInitialization()">测试应用初始化</button>
            <button class="test-button" onclick="clearResults()">清除结果</button>
            
            <div class="result-area" id="testResults">
                点击上方按钮开始测试...
            </div>
        </div>
        
        <div class="summary" id="summary">
            <h3>📊 测试总结</h3>
            <div class="summary-item">
                <span class="summary-label">总模块数:</span>
                <span class="summary-value" id="totalModules">-</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">成功加载:</span>
                <span class="summary-value success-text" id="successModules">-</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">加载失败:</span>
                <span class="summary-value error-text" id="failedModules">-</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">应用状态:</span>
                <span class="summary-value" id="appStatus">-</span>
            </div>
        </div>
    </div>

    <script>
        // 模块列表
        const modules = [
            'Utils',
            'CountdownManager', 
            'TransactionTracker',
            'UIEffects',
            'BackendManager',
            'TokenHoldersManager',
            'WalletManager',
            'WhitepaperModal',
            'ClaimRewardModal',
            'MemeCoinApp'
        ];
        
        let testResults = [];
        
        // 初始化页面
        document.addEventListener('DOMContentLoaded', () => {
            updateModuleGrid();
            updateSummary();
        });
        
        // 更新模块状态网格
        function updateModuleGrid() {
            const grid = document.getElementById('moduleGrid');
            grid.innerHTML = '';
            
            modules.forEach(moduleName => {
                const card = document.createElement('div');
                card.className = 'module-card';
                
                const isLoaded = typeof window[moduleName] !== 'undefined';
                const status = isLoaded ? 'success' : 'error';
                const statusText = isLoaded ? '✅ 已加载' : '❌ 未加载';
                
                card.classList.add(status);
                
                card.innerHTML = `
                    <div class="module-name">${moduleName}</div>
                    <div class="module-status">${statusText}</div>
                    <div class="module-details">
                        全局对象: ${isLoaded ? 'window.' + moduleName : 'undefined'}<br>
                        类型: ${isLoaded ? typeof window[moduleName] : 'N/A'}
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }
        
        // 更新总结
        function updateSummary() {
            const totalModules = modules.length;
            const successModules = modules.filter(name => typeof window[name] !== 'undefined').length;
            const failedModules = totalModules - successModules;
            
            document.getElementById('totalModules').textContent = totalModules;
            document.getElementById('successModules').textContent = successModules;
            document.getElementById('failedModules').textContent = failedModules;
            
            // 检查应用状态
            const appStatus = typeof window.memeCoinApp !== 'undefined' ? 
                '✅ 已初始化' : '❌ 未初始化';
            document.getElementById('appStatus').textContent = appStatus;
        }
        
        // 测试所有模块
        function testAllModules() {
            clearResults();
            addResult('🧪 开始测试所有模块...\n');
            
            let successCount = 0;
            let failCount = 0;
            
            modules.forEach(moduleName => {
                const isLoaded = typeof window[moduleName] !== 'undefined';
                
                if (isLoaded) {
                    addResult(`✅ ${moduleName}: 已加载`);
                    successCount++;
                    
                    // 尝试实例化
                    try {
                        if (moduleName === 'MemeCoinApp') {
                            // MemeCoinApp 已经在 DOMContentLoaded 中实例化
                            addResult(`   └─ 应用实例: ${typeof window.memeCoinApp !== 'undefined' ? '已创建' : '未创建'}`);
                        } else {
                            const instance = new window[moduleName]();
                            addResult(`   └─ 实例化: 成功`);
                        }
                    } catch (error) {
                        addResult(`   └─ 实例化: 失败 - ${error.message}`);
                        failCount++;
                    }
                } else {
                    addResult(`❌ ${moduleName}: 未加载`);
                    failCount++;
                }
            });
            
            addResult(`\n📊 测试结果: ${successCount} 成功, ${failCount} 失败`);
            updateModuleGrid();
            updateSummary();
        }
        
        // 测试交易检测
        function testTransactionDetection() {
            clearResults();
            addResult('🔍 测试交易检测功能...\n');
            
            // 检查检测控制配置
            const detectionConfig = localStorage.getItem('memeCoinDetection');
            addResult(`检测控制配置: ${detectionConfig || '未设置'}`);
            
            if (detectionConfig) {
                try {
                    const config = JSON.parse(detectionConfig);
                    addResult(`  └─ isRunning: ${config.isRunning}`);
                    addResult(`  └─ tokenAddress: ${config.tokenAddress || '未设置'}`);
                    addResult(`  └─ rpcUrl: ${config.rpcUrl || '未设置'}`);
                } catch (error) {
                    addResult(`  └─ 配置解析失败: ${error.message}`);
                }
            }
            
            // 检查 TransactionTracker
            if (typeof window.TransactionTracker !== 'undefined') {
                addResult(`✅ TransactionTracker: 已加载`);
                
                // 检查 BackendManager
                if (typeof window.BackendManager !== 'undefined') {
                    addResult(`✅ BackendManager: 已加载`);
                    
                    try {
                        const backend = new BackendManager();
                        const detectionControl = backend.getDetectionControl();
                        addResult(`  └─ 检测控制状态: ${detectionControl ? JSON.stringify(detectionControl) : '未获取到'}`);
                    } catch (error) {
                        addResult(`  └─ BackendManager 初始化失败: ${error.message}`);
                    }
                } else {
                    addResult(`❌ BackendManager: 未加载`);
                }
            } else {
                addResult(`❌ TransactionTracker: 未加载`);
            }
            
            // 检查应用实例
            if (typeof window.memeCoinApp !== 'undefined') {
                addResult(`✅ MemeCoinApp: 已初始化`);
                
                const transactionModule = window.memeCoinApp.getTransactionTracker();
                if (transactionModule) {
                    addResult(`  └─ 交易模块: 已获取`);
                } else {
                    addResult(`  └─ 交易模块: 未获取`);
                }
            } else {
                addResult(`❌ MemeCoinApp: 未初始化`);
            }
        }
        
        // 测试应用初始化
        function testAppInitialization() {
            clearResults();
            addResult('🚀 测试应用初始化...\n');
            
            if (typeof window.MemeCoinApp !== 'undefined') {
                addResult(`✅ MemeCoinApp 类: 已定义`);
                
                try {
                    // 创建新的应用实例
                    const testApp = new window.MemeCoinApp();
                    addResult(`✅ 应用实例: 创建成功`);
                    
                    // 检查模块
                    const modules = testApp.modules;
                    addResult(`📦 模块状态:`);
                    
                    Object.entries(modules).forEach(([name, module]) => {
                        const status = module ? '✅ 已初始化' : '❌ 未初始化';
                        addResult(`  └─ ${name}: ${status}`);
                    });
                    
                    // 清理测试实例
                    if (typeof testApp.destroy === 'function') {
                        testApp.destroy();
                        addResult(`🧹 测试实例: 已清理`);
                    }
                    
                } catch (error) {
                    addResult(`❌ 应用实例: 创建失败 - ${error.message}`);
                    addResult(`   错误堆栈: ${error.stack}`);
                }
            } else {
                addResult(`❌ MemeCoinApp 类: 未定义`);
            }
        }
        
        // 添加测试结果
        function addResult(message) {
            testResults.push(message);
            document.getElementById('testResults').textContent = testResults.join('\n');
        }
        
        // 清除结果
        function clearResults() {
            testResults = [];
            document.getElementById('testResults').textContent = '点击上方按钮开始测试...';
        }
        
        // 定期更新状态
        setInterval(() => {
            updateModuleGrid();
            updateSummary();
        }, 2000);
    </script>
</body>
</html> 