<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº¤æ˜“æ£€æµ‹çŠ¶æ€æ£€æŸ¥å™¨</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .status-item {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .status-item.error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .status-item.success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .status-item.warning {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        .status-label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .status-value {
            font-family: monospace;
            color: #666;
        }
        .action-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .action-btn:hover {
            background: #0056b3;
        }
        .action-btn.danger {
            background: #dc3545;
        }
        .action-btn.danger:hover {
            background: #c82333;
        }
        .action-btn.success {
            background: #28a745;
        }
        .action-btn.success:hover {
            background: #218838;
        }
        .log-container {
            background: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .config-display {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” äº¤æ˜“æ£€æµ‹çŠ¶æ€æ£€æŸ¥å™¨</h1>
        <p>è¯Šæ–­äº¤æ˜“æ£€æµ‹åŠŸèƒ½ä¸ºä»€ä¹ˆä¸å·¥ä½œ</p>

        <!-- æ£€æµ‹æ§åˆ¶çŠ¶æ€ -->
        <div class="section">
            <h2>ğŸ¯ æ£€æµ‹æ§åˆ¶çŠ¶æ€</h2>
            <div id="detectionStatus">
                æ­£åœ¨æ£€æŸ¥æ£€æµ‹æ§åˆ¶çŠ¶æ€...
            </div>
            <button class="action-btn" onclick="checkDetectionStatus()">åˆ·æ–°æ£€æµ‹çŠ¶æ€</button>
            <button class="action-btn success" onclick="startDetection()">å¯åŠ¨æ£€æµ‹</button>
            <button class="action-btn danger" onclick="stopDetection()">åœæ­¢æ£€æµ‹</button>
        </div>

        <!-- é…ç½®æ£€æŸ¥ -->
        <div class="section">
            <h2>âš™ï¸ é…ç½®æ£€æŸ¥</h2>
            <div id="configStatus">
                æ­£åœ¨æ£€æŸ¥é…ç½®...
            </div>
            <button class="action-btn" onclick="checkConfig()">åˆ·æ–°é…ç½®</button>
        </div>

        <!-- RPC è¿æ¥çŠ¶æ€ -->
        <div class="section">
            <h2>ğŸŒ RPC è¿æ¥çŠ¶æ€</h2>
            <div id="rpcStatus">
                æ­£åœ¨æ£€æŸ¥ RPC è¿æ¥...
            </div>
            <button class="action-btn" onclick="checkRpcConnection()">æµ‹è¯• RPC è¿æ¥</button>
        </div>

        <!-- æ¨¡å—çŠ¶æ€ -->
        <div class="section">
            <h2>ğŸ”§ æ¨¡å—çŠ¶æ€</h2>
            <div id="moduleStatus">
                æ­£åœ¨æ£€æŸ¥æ¨¡å—çŠ¶æ€...
            </div>
            <button class="action-btn" onclick="checkModuleStatus()">åˆ·æ–°æ¨¡å—çŠ¶æ€</button>
        </div>

        <!-- äº¤æ˜“è®°å½• -->
        <div class="section">
            <h2>ğŸ“Š äº¤æ˜“è®°å½•</h2>
            <div id="transactionStatus">
                æ­£åœ¨æ£€æŸ¥äº¤æ˜“è®°å½•...
            </div>
            <button class="action-btn" onclick="checkTransactions()">åˆ·æ–°äº¤æ˜“è®°å½•</button>
            <button class="action-btn danger" onclick="clearTransactions()">æ¸…ç©ºäº¤æ˜“è®°å½•</button>
        </div>

        <!-- å®æ—¶æ—¥å¿— -->
        <div class="section">
            <h2>ğŸ“ å®æ—¶æ—¥å¿—</h2>
            <button class="action-btn" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
            <button class="action-btn" onclick="exportLog()">å¯¼å‡ºæ—¥å¿—</button>
            <div id="logContainer" class="log-container">
                ç­‰å¾…æ—¥å¿—è¾“å‡º...
            </div>
        </div>

        <!-- é…ç½®è¯¦æƒ… -->
        <div class="section">
            <h2>ğŸ“‹ é…ç½®è¯¦æƒ…</h2>
            <button class="action-btn" onclick="showConfigDetails()">æ˜¾ç¤ºé…ç½®è¯¦æƒ…</button>
            <div id="configDetails" class="config-display" style="display: none;">
                é…ç½®è¯¦æƒ…å°†åœ¨è¿™é‡Œæ˜¾ç¤º...
            </div>
        </div>
    </div>

    <script>
        let logMessages = [];

        // æ·»åŠ æ—¥å¿—
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            logMessages.push(logEntry);
            
            const logContainer = document.getElementById('logContainer');
            logContainer.textContent = logMessages.join('\n');
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // æ£€æŸ¥æ£€æµ‹çŠ¶æ€
        function checkDetectionStatus() {
            addLog('æ£€æŸ¥æ£€æµ‹æ§åˆ¶çŠ¶æ€...');
            
            const detectionConfig = localStorage.getItem('memeCoinDetection');
            const statusDiv = document.getElementById('detectionStatus');
            
            if (detectionConfig) {
                try {
                    const config = JSON.parse(detectionConfig);
                    let statusHtml = '';
                    
                    if (config.isRunning) {
                        statusHtml = `
                            <div class="status-item success">
                                <div class="status-label">âœ… æ£€æµ‹çŠ¶æ€: è¿è¡Œä¸­</div>
                                <div class="status-value">RPC URL: ${config.rpcUrl || 'æœªè®¾ç½®'}</div>
                                <div class="status-value">Token Address: ${config.tokenAddress || 'æœªè®¾ç½®'}</div>
                                <div class="status-value">å¯åŠ¨æ—¶é—´: ${config.startTime || 'æœªçŸ¥'}</div>
                                <div class="status-value">æœ€åæ›´æ–°: ${config.lastUpdate || 'æœªçŸ¥'}</div>
                            </div>
                        `;
                        addLog('æ£€æµ‹æ§åˆ¶å·²å¯åŠ¨', 'success');
                    } else {
                        statusHtml = `
                            <div class="status-item warning">
                                <div class="status-label">âš ï¸ æ£€æµ‹çŠ¶æ€: å·²åœæ­¢</div>
                                <div class="status-value">é…ç½®å­˜åœ¨ä½†æœªè¿è¡Œ</div>
                            </div>
                        `;
                        addLog('æ£€æµ‹æ§åˆ¶å·²åœæ­¢', 'warning');
                    }
                    
                    statusDiv.innerHTML = statusHtml;
                } catch (error) {
                    statusDiv.innerHTML = `
                        <div class="status-item error">
                            <div class="status-label">âŒ æ£€æµ‹çŠ¶æ€: é…ç½®é”™è¯¯</div>
                            <div class="status-value">é”™è¯¯: ${error.message}</div>
                        </div>
                    `;
                    addLog(`æ£€æµ‹é…ç½®è§£æé”™è¯¯: ${error.message}`, 'error');
                }
            } else {
                statusDiv.innerHTML = `
                    <div class="status-item error">
                        <div class="status-label">âŒ æ£€æµ‹çŠ¶æ€: æœªé…ç½®</div>
                        <div class="status-value">æœªæ‰¾åˆ°æ£€æµ‹æ§åˆ¶é…ç½®</div>
                    </div>
                `;
                addLog('æœªæ‰¾åˆ°æ£€æµ‹æ§åˆ¶é…ç½®', 'error');
            }
        }

        // æ£€æŸ¥é…ç½®
        function checkConfig() {
            addLog('æ£€æŸ¥ç³»ç»Ÿé…ç½®...');
            
            const configDiv = document.getElementById('configStatus');
            let configHtml = '';
            
            // æ£€æŸ¥ RPC é…ç½®
            const rpcConfig = localStorage.getItem('memeCoinAdminConfig');
            if (rpcConfig) {
                try {
                    const config = JSON.parse(rpcConfig);
                    const rpc = config.rpc || {};
                    const token = config.token || {};
                    
                    configHtml += `
                        <div class="status-item ${rpc.url ? 'success' : 'error'}">
                            <div class="status-label">ğŸŒ RPC é…ç½®</div>
                            <div class="status-value">URL: ${rpc.url || 'æœªè®¾ç½®'}</div>
                            <div class="status-value">è¿æ¥çŠ¶æ€: ${rpc.connected ? 'å·²è¿æ¥' : 'æœªè¿æ¥'}</div>
                        </div>
                    `;
                    
                    configHtml += `
                        <div class="status-item ${token.address ? 'success' : 'error'}">
                            <div class="status-label">ğŸª™ Token é…ç½®</div>
                            <div class="status-value">åœ°å€: ${token.address || 'æœªè®¾ç½®'}</div>
                            <div class="status-value">åç§°: ${token.name || 'æœªè®¾ç½®'}</div>
                            <div class="status-value">éªŒè¯çŠ¶æ€: ${token.validated ? 'å·²éªŒè¯' : 'æœªéªŒè¯'}</div>
                        </div>
                    `;
                    
                    addLog('é…ç½®æ£€æŸ¥å®Œæˆ', 'success');
                } catch (error) {
                    configHtml += `
                        <div class="status-item error">
                            <div class="status-label">âŒ é…ç½®é”™è¯¯</div>
                            <div class="status-value">é”™è¯¯: ${error.message}</div>
                        </div>
                    `;
                    addLog(`é…ç½®è§£æé”™è¯¯: ${error.message}`, 'error');
                }
            } else {
                configHtml += `
                    <div class="status-item error">
                        <div class="status-label">âŒ é…ç½®æœªæ‰¾åˆ°</div>
                        <div class="status-value">æœªæ‰¾åˆ°ç®¡ç†é…ç½®</div>
                    </div>
                `;
                addLog('æœªæ‰¾åˆ°ç®¡ç†é…ç½®', 'error');
            }
            
            configDiv.innerHTML = configHtml;
        }

        // æ£€æŸ¥ RPC è¿æ¥
        function checkRpcConnection() {
            addLog('æµ‹è¯• RPC è¿æ¥...');
            
            const rpcConfig = localStorage.getItem('memeCoinAdminConfig');
            if (!rpcConfig) {
                addLog('æœªæ‰¾åˆ° RPC é…ç½®', 'error');
                return;
            }
            
            try {
                const config = JSON.parse(rpcConfig);
                const rpcUrl = config.rpc?.url;
                
                if (!rpcUrl) {
                    addLog('RPC URL æœªè®¾ç½®', 'error');
                    return;
                }
                
                // ç®€å•çš„è¿æ¥æµ‹è¯•
                fetch(rpcUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 1,
                        method: 'getHealth'
                    })
                })
                .then(response => {
                    if (response.ok) {
                        addLog('RPC è¿æ¥æµ‹è¯•æˆåŠŸ', 'success');
                        document.getElementById('rpcStatus').innerHTML = `
                            <div class="status-item success">
                                <div class="status-label">âœ… RPC è¿æ¥: æ­£å¸¸</div>
                                <div class="status-value">URL: ${rpcUrl}</div>
                            </div>
                        `;
                    } else {
                        addLog(`RPC è¿æ¥æµ‹è¯•å¤±è´¥: ${response.status}`, 'error');
                        document.getElementById('rpcStatus').innerHTML = `
                            <div class="status-item error">
                                <div class="status-label">âŒ RPC è¿æ¥: å¤±è´¥</div>
                                <div class="status-value">çŠ¶æ€ç : ${response.status}</div>
                            </div>
                        `;
                    }
                })
                .catch(error => {
                    addLog(`RPC è¿æ¥æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                    document.getElementById('rpcStatus').innerHTML = `
                        <div class="status-item error">
                            <div class="status-label">âŒ RPC è¿æ¥: å¤±è´¥</div>
                            <div class="status-value">é”™è¯¯: ${error.message}</div>
                        </div>
                    `;
                });
            } catch (error) {
                addLog(`RPC é…ç½®è§£æé”™è¯¯: ${error.message}`, 'error');
            }
        }

        // æ£€æŸ¥æ¨¡å—çŠ¶æ€
        function checkModuleStatus() {
            addLog('æ£€æŸ¥æ¨¡å—çŠ¶æ€...');
            
            const moduleDiv = document.getElementById('moduleStatus');
            let moduleHtml = '';
            
            // æ£€æŸ¥å…¨å±€å¯¹è±¡
            const modules = {
                'BackendManager': window.backendManager,
                'TransactionTracker': window.transactionTracker,
                'MemeCoinApp': window.memeCoinApp
            };
            
            Object.entries(modules).forEach(([name, module]) => {
                const status = module ? 'success' : 'error';
                const label = module ? 'âœ…' : 'âŒ';
                
                moduleHtml += `
                    <div class="status-item ${status}">
                        <div class="status-label">${label} ${name}</div>
                        <div class="status-value">çŠ¶æ€: ${module ? 'å·²åŠ è½½' : 'æœªåŠ è½½'}</div>
                    </div>
                `;
            });
            
            moduleDiv.innerHTML = moduleHtml;
            addLog('æ¨¡å—çŠ¶æ€æ£€æŸ¥å®Œæˆ', 'info');
        }

        // æ£€æŸ¥äº¤æ˜“è®°å½•
        function checkTransactions() {
            addLog('æ£€æŸ¥äº¤æ˜“è®°å½•...');
            
            const transactionDiv = document.getElementById('transactionStatus');
            
            // æ£€æŸ¥æœ¬åœ°äº¤æ˜“è®°å½•
            const localTransactions = localStorage.getItem('memeCoinBackendTransactions');
            if (localTransactions) {
                try {
                    const data = JSON.parse(localTransactions);
                    const transactions = data.transactions || [];
                    
                    transactionDiv.innerHTML = `
                        <div class="status-item success">
                            <div class="status-label">ğŸ“Š æœ¬åœ°äº¤æ˜“è®°å½•</div>
                            <div class="status-value">äº¤æ˜“æ•°é‡: ${transactions.length}</div>
                            <div class="status-value">æœ€åæ›´æ–°: ${data.lastUpdate || 'æœªçŸ¥'}</div>
                        </div>
                    `;
                    
                    addLog(`æ‰¾åˆ° ${transactions.length} æ¡æœ¬åœ°äº¤æ˜“è®°å½•`, 'success');
                } catch (error) {
                    transactionDiv.innerHTML = `
                        <div class="status-item error">
                            <div class="status-label">âŒ äº¤æ˜“è®°å½•é”™è¯¯</div>
                            <div class="status-value">é”™è¯¯: ${error.message}</div>
                        </div>
                    `;
                    addLog(`äº¤æ˜“è®°å½•è§£æé”™è¯¯: ${error.message}`, 'error');
                }
            } else {
                transactionDiv.innerHTML = `
                    <div class="status-item warning">
                        <div class="status-label">âš ï¸ äº¤æ˜“è®°å½•</div>
                        <div class="status-value">æœªæ‰¾åˆ°æœ¬åœ°äº¤æ˜“è®°å½•</div>
                    </div>
                `;
                addLog('æœªæ‰¾åˆ°æœ¬åœ°äº¤æ˜“è®°å½•', 'warning');
            }
        }

        // å¯åŠ¨æ£€æµ‹
        function startDetection() {
            addLog('å°è¯•å¯åŠ¨æ£€æµ‹...');
            
            const rpcConfig = localStorage.getItem('memeCoinAdminConfig');
            if (!rpcConfig) {
                addLog('æœªæ‰¾åˆ° RPC é…ç½®ï¼Œæ— æ³•å¯åŠ¨æ£€æµ‹', 'error');
                return;
            }
            
            try {
                const config = JSON.parse(rpcConfig);
                const rpcUrl = config.rpc?.url;
                const tokenAddress = config.token?.address;
                
                if (!rpcUrl || !tokenAddress) {
                    addLog('RPC URL æˆ– Token åœ°å€æœªè®¾ç½®', 'error');
                    return;
                }
                
                const detectionConfig = {
                    isRunning: true,
                    rpcUrl: rpcUrl,
                    tokenAddress: tokenAddress,
                    startTime: new Date().toISOString(),
                    lastUpdate: new Date().toISOString()
                };
                
                localStorage.setItem('memeCoinDetection', JSON.stringify(detectionConfig));
                addLog('æ£€æµ‹æ§åˆ¶å·²å¯åŠ¨', 'success');
                
                // åˆ·æ–°çŠ¶æ€æ˜¾ç¤º
                checkDetectionStatus();
                
            } catch (error) {
                addLog(`å¯åŠ¨æ£€æµ‹å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // åœæ­¢æ£€æµ‹
        function stopDetection() {
            addLog('åœæ­¢æ£€æµ‹...');
            
            localStorage.removeItem('memeCoinDetection');
            addLog('æ£€æµ‹æ§åˆ¶å·²åœæ­¢', 'warning');
            
            // åˆ·æ–°çŠ¶æ€æ˜¾ç¤º
            checkDetectionStatus();
        }

        // æ¸…ç©ºäº¤æ˜“è®°å½•
        function clearTransactions() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰äº¤æ˜“è®°å½•å—ï¼Ÿ')) {
                localStorage.removeItem('memeCoinBackendTransactions');
                addLog('äº¤æ˜“è®°å½•å·²æ¸…ç©º', 'warning');
                checkTransactions();
            }
        }

        // æ¸…ç©ºæ—¥å¿—
        function clearLog() {
            logMessages = [];
            document.getElementById('logContainer').textContent = 'æ—¥å¿—å·²æ¸…ç©º...';
        }

        // å¯¼å‡ºæ—¥å¿—
        function exportLog() {
            const logText = logMessages.join('\n');
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `transaction-detection-log-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            addLog('æ—¥å¿—å·²å¯¼å‡º', 'info');
        }

        // æ˜¾ç¤ºé…ç½®è¯¦æƒ…
        function showConfigDetails() {
            const detailsDiv = document.getElementById('configDetails');
            const isVisible = detailsDiv.style.display !== 'none';
            
            if (!isVisible) {
                const allConfigs = {};
                
                // æ”¶é›†æ‰€æœ‰é…ç½®
                const configKeys = [
                    'memeCoinAdminConfig',
                    'memeCoinDetection',
                    'memeCoinBackendTransactions',
                    'memeCoinSuccessAddresses',
                    'memeCoinTokenHolders'
                ];
                
                configKeys.forEach(key => {
                    const value = localStorage.getItem(key);
                    if (value) {
                        try {
                            allConfigs[key] = JSON.parse(value);
                        } catch (error) {
                            allConfigs[key] = `è§£æé”™è¯¯: ${error.message}`;
                        }
                    } else {
                        allConfigs[key] = 'æœªè®¾ç½®';
                    }
                });
                
                detailsDiv.textContent = JSON.stringify(allConfigs, null, 2);
                detailsDiv.style.display = 'block';
                addLog('é…ç½®è¯¦æƒ…å·²æ˜¾ç¤º', 'info');
            } else {
                detailsDiv.style.display = 'none';
                addLog('é…ç½®è¯¦æƒ…å·²éšè—', 'info');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', () => {
            addLog('äº¤æ˜“æ£€æµ‹çŠ¶æ€æ£€æŸ¥å™¨å·²å¯åŠ¨', 'info');
            
            // æ‰§è¡Œåˆå§‹æ£€æŸ¥
            checkDetectionStatus();
            checkConfig();
            checkModuleStatus();
            checkTransactions();
            
            // è®¾ç½®å®šæ—¶åˆ·æ–°
            setInterval(() => {
                checkDetectionStatus();
            }, 10000); // æ¯10ç§’åˆ·æ–°ä¸€æ¬¡æ£€æµ‹çŠ¶æ€
        });
    </script>
</body>
</html> 